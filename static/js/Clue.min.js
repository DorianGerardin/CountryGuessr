class Clue{constructor(clueID,remainAttempts,clueNode,clueImgContainer,clueImg,clueImgUnlocked,clueTextNode,clueText,cluePointerLeft,remainAttemptsTextNode,apiURL){this.clueID=clueID,this.clueNode=clueNode,this.clueImgContainer=clueImgContainer,this.clueImg=clueImg,this.clueImgUnlocked=clueImgUnlocked,this.clueTextNode=clueTextNode,this.clueText=clueText,this.cluePointerLeft=cluePointerLeft,this.remainAttempts=remainAttempts,this.remainAttemptsTextNode=remainAttemptsTextNode,this.InitiateRemainAttempts(),this.contentNodeText=null,this.contentNode=null,this.apiURL=apiURL,this.isUnlocked=!1,this.hasBeenUsed=!1}static currentVisibleClueID=-1;static allClues=[];static parser=new DOMParser;InitiateRemainAttempts(){this.remainAttemptsTextNode.innerText=this.remainAttempts}Unlock(){if(this.isUnlocked)return;const scaleUpAndDown=[{transform:"scale(1)"},{transform:"scale(1.075)"}],scaleUpAndDownTiming={duration:250,iterations:6,direction:"alternate",easing:"ease-in-out"};WaitForClue(this.apiURL).then((data=>{let border=JSON.parse(localStorage.getItem("border")),history=JSON.parse(localStorage.getItem("history"));1===this.clueID&&!gameID&&border?this.contentNodeText=border:1===this.clueID&&gameID?this.contentNodeText=history[gameID].border||data.content:this.contentNodeText=data.content,this.contentNode=Clue.parser.parseFromString(this.contentNodeText,"text/html").body.firstChild,this.contentNode.style.display="none",document.getElementById("clueContent").appendChild(this.contentNode),this.isUnlocked=!0,this.remainAttempts=0,this.clueTextNode.innerHTML=this.clueText,this.clueNode.classList.add("clueHover","clueUnlocked"),this.clueImgContainer.classList.add("clueImgUnlocked"),this.clueImg.classList.replace(this.clueImg.id,this.clueImgUnlocked),this.clueNode.animate(scaleUpAndDown,scaleUpAndDownTiming),this.clueNode.addEventListener("click",(()=>{if(Clue.currentVisibleClueID===this.clueID)return void this.ToggleContent();this.hasBeenUsed||game.HasWon()||(this.hasBeenUsed=!0),history=JSON.parse(localStorage.getItem("history"));let cluesData=Clue.GetDataForLocalStorage();if(gameID&&!game.HasWon()?history[gameID].UsedClueCount=Clue.UsedClueCount():gameID||game.HasWon()||(history[dayCount].UsedClueCount=Clue.UsedClueCount(),localStorage.setItem("clues",JSON.stringify(cluesData))),localStorage.setItem("history",JSON.stringify(history)),Clue.allClues[this.clueID]=this,1===this.clueID){if(gameID)history[gameID].border||(history[gameID].border=data.content);else if(border=JSON.parse(localStorage.getItem("border")),!border){let borderValue=data.content;localStorage.setItem("border",JSON.stringify(borderValue)),history[dayCount].border=borderValue}localStorage.setItem("history",JSON.stringify(history))}this.ToggleContent()}))}))}DecrementAttempts(){this.remainAttempts<=0||(this.remainAttempts--,0===this.remainAttempts?this.Unlock():this.remainAttemptsTextNode.innerText=this.remainAttempts)}ToggleContent(){let clueContentContainer=document.getElementById("clueContentContainer"),cluePointer=document.getElementById("cluePointer"),isContainerDisplayed="flex"===getComputedStyle(clueContentContainer).display;cluePointer.style.left=this.cluePointerLeft,isContainerDisplayed?isContainerDisplayed&&Clue.currentVisibleClueID===this.clueID?(this.contentNode.style.display="none",clueContentContainer.style.display="none",Clue.currentVisibleClueID=-1):(Clue.allClues[Clue.currentVisibleClueID].contentNode.style.display="none",this.contentNode.style.display="flex",Clue.currentVisibleClueID=this.clueID):(this.contentNode.style.display="flex",clueContentContainer.style.display="flex",Clue.currentVisibleClueID=this.clueID)}static UpdateCluesAttempts(){Clue.allClues.forEach((clue=>{clue.DecrementAttempts()}))}static UnlockAllClues(){Clue.allClues.forEach((clue=>{clue.Unlock()}))}static UsedClueCount(){let sum=0;return Clue.allClues.forEach((clue=>{clue.hasBeenUsed&&sum++})),sum}static GetDataForLocalStorage(){let returnData=[];return Clue.allClues.forEach((clue=>{let clueData={clueID:clue.clueID,hasBeenUsed:clue.hasBeenUsed};returnData.push(clueData)})),returnData}}async function WaitForClue(apiURL){const response=await fetch(apiURL);return await response.json()}function isSummerTime(){const now=new Date,year=now.getFullYear(),marchLastSunday=new Date(year,2,31-new Date(year,2,31).getDay()),octoberLastSunday=new Date(year,9,31-new Date(year,9,31).getDay());return now>=marchLastSunday&&now<octoberLastSunday}function GetLocalStorageExpirationDate(){const now=new Date;let expirationDate,localHour;const timeZoneDifferenceHours=now.getTimezoneOffset()/60+(isSummerTime()?2:1);return timeZoneDifferenceHours<=0?(localHour=23+Math.abs(timeZoneDifferenceHours),expirationDate=new Date(now.getFullYear(),now.getMonth(),now.getDate(),localHour,59,59)):(localHour=23-Math.abs(timeZoneDifferenceHours),expirationDate=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,localHour,59,59)),expirationDate}function InitiateShapeClue(){let saveClues=JSON.parse(localStorage.getItem("clues")),shapeClueNode=document.getElementById("clueShape"),shapeClueImgContainer=document.getElementById("clueShapeImgContainer"),shapeClueImg=document.getElementById("clueShapeImg"),shapeClueTextNode=document.getElementById("clueTextShape"),shapeClueAttemptsText=document.getElementById("shapeClueAttempts"),clueShape=null,apiURL=gameID?`/countryShape?game=${gameID}`:"/countryShape";clueShape=new Clue(0,5,shapeClueNode,shapeClueImgContainer,shapeClueImg,"clueShapeImgUnlocked",shapeClueTextNode,"Indice forme du pays","14%",shapeClueAttemptsText,apiURL),null!==saveClues&&(clueShape.hasBeenUsed=saveClues[0].hasBeenUsed),Clue.allClues.push(clueShape)}function InitiateBorderClue(){let saveClues=JSON.parse(localStorage.getItem("clues")),borderClueNode=document.getElementById("clueBorder"),borderClueImgContainer=document.getElementById("clueBorderImgContainer"),borderClueImg=document.getElementById("clueBorderImg"),borderClueTextNode=document.getElementById("clueTextBorder"),borderClueAttemptsText=document.getElementById("borderClueAttempts"),borderClue=null,apiURL=gameID?`/randomBorder?game=${gameID}`:"/randomBorder";borderClue=new Clue(1,8,borderClueNode,borderClueImgContainer,borderClueImg,"clueBorderImgUnlocked",borderClueTextNode,"Indice pays frontalier","50%",borderClueAttemptsText,apiURL),null!==saveClues&&(borderClue.hasBeenUsed=saveClues[1].hasBeenUsed),Clue.allClues.push(borderClue)}function InitiateCapitalClue(){let saveClues=JSON.parse(localStorage.getItem("clues")),capitalClueNode=document.getElementById("clueCapital"),capitalClueImgContainer=document.getElementById("clueCapitalImgContainer"),capitalClueImg=document.getElementById("clueCapitalImg"),capitalClueTextNode=document.getElementById("clueTextCapital"),capitalClueAttemptsText=document.getElementById("capitalClueAttempts"),capitalClue=null,apiURL=gameID?`/capital?game=${gameID}`:"/capital";capitalClue=new Clue(2,11,capitalClueNode,capitalClueImgContainer,capitalClueImg,"clueCapitalImgUnlocked",capitalClueTextNode,"Indice capitale","86%",capitalClueAttemptsText,apiURL),null!==saveClues&&(capitalClue.hasBeenUsed=saveClues[2].hasBeenUsed),Clue.allClues.push(capitalClue)}function GoToPage(page){window.location.href=`${window.location.origin}/${page}`}function InitiateClues(){let expiration=JSON.parse(localStorage.getItem("expirationDate"));null!==expiration&&new Date(expiration)<new Date&&ClearLocalStorage(),localStorage.setItem("expirationDate",JSON.stringify(GetLocalStorageExpirationDate().getTime()));let isFirstTime=JSON.parse(localStorage.getItem("isFirstTime"));(null===isFirstTime||isFirstTime)&&(GoToPage("welcome"),localStorage.setItem("isFirstTime",JSON.stringify(!1))),InitiateShapeClue(),InitiateBorderClue(),InitiateCapitalClue()}InitiateClues();